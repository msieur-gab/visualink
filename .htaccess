# Enable rewriting
RewriteEngine On

# Redirect /q/code to redirect.php?code=code
RewriteRule ^q/([a-zA-Z0-9_-]+)$ redirect.php?code=$1 [L]

# QR code generation endpoint
RewriteRule ^generate-qr/([a-zA-Z0-9_-]+)$ generate-qr.php?code=$1 [L]

# API routes
RewriteRule ^api/?$ api.php [L]
RewriteRule ^api/([a-zA-Z0-9_-]+)$ api.php/$1 [L]

# Protect data directory - allow manifest.json and other system files
# Only deny direct access to /data/ directory via rewrite
RewriteRule ^data/.*\.json$ - [F]

# Disable directory listing
Options -Indexes

# Force HTTPS
RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
