# Enable rewriting
RewriteEngine On

# Redirect /q/code to redirect.php?code=code
RewriteRule ^q/([a-zA-Z0-9_-]+)$ redirect.php?code=$1 [L]

# QR code generation endpoint
RewriteRule ^generate-qr/([a-zA-Z0-9_-]+)$ generate-qr.php?code=$1 [L]

# API routes - PUBLIC endpoint MUST come first (most specific)
RewriteRule ^api/qr/([a-zA-Z0-9_-]+)$ api-qr.php [L]
# Admin API routes (require authentication)
RewriteRule ^api/?$ api.php [L]
RewriteRule ^api/([a-zA-Z0-9_-]+)$ api.php/$1 [L]

# Protect data directory - deny direct access to /data/*.json files only
# Allow all other JSON files (like manifest.json in /poc/)
<FilesMatch "^/data/.*\.json$">
    Order allow,deny
    Deny from all
</FilesMatch>

# Disable directory listing
Options -Indexes

# Force HTTPS
RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
